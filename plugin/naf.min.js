var version="1.0.9s4c2r107";NAF={};WebApp={};KeyMap.defineKeys(KeyMap.NORMAL,{3:"back"},!0);include("naf-webapp/"+version+"/naf-webapp.min.js");var model=new WebApp.Model,controller=new WebApp.Controller(model);controller.registerPMRPC();
controller.on("model.initialized",function(){function f(a){a=a||ApplicationManager.getApplications();var e=b?b():1;ids=a.filter(function(a){return!0===meta[a].menu});ids.forEach(function(a){var b=ApplicationManager.getMetadataByKey(a,"name"),f=ApplicationManager.getIcon(a),g=ApplicationManager.getLaunchURL(a);d("model.state.applications."+ ++e+"?name="+b+"&type=webapp&id="+a+"&windowId="+window.name+"&url="+g+"&state=loaded&viewState=hidden&pictures=["+f+"]")});d("model.state.applications."+(b?b():
1)+"?state=loaded")}function g(a){var b=[],c=model.channels.filter(function(b){return b.id===a});0<c.length&&ApplicationManager.getApplicationsByChannelName(c[0].name).forEach(function(a){b.push({id:a,name:ApplicationManager.getMetadataByKey(a,"name"),image:ApplicationManager.getIcon(a),url:ApplicationManager.getLaunchURL(a)})});return[{id:ui,name:"Apps",image:ApplicationManager.getIcon(ui),url:ApplicationManager.getMainURL()}].concat(b)}var d=controller["do"],b=controller.getApplicationIndex;window.addEventListener("focus",
function(){var a=b?b():1;d("model.state.applications."+a+"?state=running");active&&apps[active]&&send(active,"onSelect",{id:apps[active].currentViewId})});window.addEventListener("blur",function(){var a=b?b():1;d("model.state.applications."+a+".appMsg",{method:"paused",message:{}});active&&active!==ui&&send(active,"exit")});controller.on("model.state.key",function(){var a=model.state.key,b=parseInt(a.keyCode,10),a=a.keyState.toLowerCase(),c=document.createEvent("Events"),d=document.activeElement||
window;"repeat"===a&&(a="down");c.initEvent("key"+a,!0,!0);c.keyCode=c.which=b;c.key=KeyMap.lookupKey(KeyMap.NORMAL,b);d.dispatchEvent(c)});controller.on("model.state.applications."+(b?b():1)+".appMsg",function(){var a=b?b():1,a=model.state.applications[a].appMsg,e;if(a.sourceId===model.state.applications[0].id){switch(a.method){case "getApplications":e=g(a.message)}e&&d("model.state.applications.0.appMsg",{method:a.method,message:e})}});ApplicationManager.complete?f():ApplicationManager.onComplete=
f});controller.init();