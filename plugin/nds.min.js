var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance();KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var NDSPlayer=function(){function e(a){g!==a&&(fire.call(b,"onStateChange",{state:a}),g=a)}var b=this,k=Player.prototype.bounds,c=!1,d=!1,h=!1,f=null,g;b.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){d&&b.src&&!c&&(c=!0,e(Player.state.PLAY))},VideoPlayer.onPlaybackEnd=function(){d&&c&&(c=!1,e(Player.state.EOF))},VideoPlayer.onPlaybackUnexpectedStop=function(){d&&(e(Player.state.STOP),b.src="")},VideoPlayer.onPlaybackError=function(){d&&b.src&&e(Player.state.ERROR)});TVContext&&
(TVContext.onContentSelectionSucceeded=function(){d||fire.call(b,"onChannelChange")});getter(b,"id",function(){return Player.TV});getter(b,"type",function(){return Player.type.VIDEO});getter(b,"channel",function(){var a=TVContext&&TVContext.getCurrentChannel()||{};return new TVChannel(a.number,a.name)});setter(b,"channel",function(a){TVContext&&TVContext.selectContentByID("service:number:"+a)});getter(b,"program",function(){var a=TVContext&&TVContext.getCurrentChannel()||{},a=a&&a.getCurrentProgram()||
{};return new TVProgram(a.title,a.description,a.startTime,a.duration)});getter(b,"startTime",function(){return 0});setter(b,"startTime",function(a){});getter(b,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(a){return 0}});setter(b,"currentTime",function(a){if(VideoPlayer)try{VideoPlayer.seek(1E3*a)}catch(b){}});getter(b,"rate",function(){if(c&&VideoPlayer)try{return VideoPlayer.speed||0}catch(a){return 1}else return 1});setter(b,"rate",function(a){});getter(b,"duration",
function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(a){return 0}});getter(b,"buffered",function(){return 100});getter(b,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(a){return!1}});setter(b,"muted",function(a){if(AudioPlayer)try{AudioPlayer.mute(!0===a)}catch(b){}});getter(b,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(a){return 1}else return 1});setter(b,"volume",function(a){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*
a,10))}catch(b){}});getter(b,"src",function(){return f});setter(b,"src",function(a){if(a&&VideoPlayer){e(Player.state.BUFFERING);if(!d)try{VideoPlayer.grab(),d=!0}catch(b){return}if(c&&f&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(k){}c=!1;try{g=null,f=a,VideoPlayer.setURI(a),VideoPlayer.start.delay(800,VideoPlayer)}catch(l){}}else if(VideoPlayer){h=!1;if(c&&f&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED){try{VideoPlayer.stop()}catch(m){}c=!1;f=
null;e(Player.state.STOP)}else c=!1,f=null;g=null;if(d){try{VideoPlayer.ungrab()}catch(n){}d=!1}}});getter(b,"paused",function(){return h});setter(b,"paused",function(a){if(c&&this.src)if(a)try{VideoPlayer.pause(),h=!0,e(Player.state.PAUSE)}catch(b){c=!1}else if(this.paused)try{VideoPlayer.resume(),h=!1,e(Player.state.PLAY)}catch(d){c=!1}});getter(b,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:k});setter(b,"bounds",function(a){var b=a&&
a.length||0;1<b&&VideoPlayer&&(4===b&&VideoPlayer.setSize(a[2],a[3]),VideoPlayer.move(a[0],a[1]))})},ndsplayer=new NDSPlayer;plugins.players.push(ndsplayer);function resetNDSPlayer(){ndsplayer.src&&(ndsplayer.src="")}Application&&(Application.onHide=function(){resetNDSPlayer()});window.addEventListener("unload",function(){resetNDSPlayer()});window.addEventListener("blur",function(){resetNDSPlayer();Application.pause()});