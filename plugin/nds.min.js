var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
UserData=TVContext&&TVContext.getUserData(),Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance(),currentChannel,currentProgram,timerProgramData;KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var syncProgramData=function(){timerProgramData&&(clearTimeout(timerProgramData),timerProgramData=void 0);currentProgram=(currentChannel=TVContext&&TVContext.getCurrentChannel())&&currentChannel.getCurrentProgram();timerProgramData=setTimeout(syncProgramData,1E3*currentProgram.duration)},NDSPlayer=function(){function c(b){q!==b&&(fire.call(a,"onStateChange",{state:b}),q=b)}function k(){fire.call(a,"onTimeChange")}function r(){e&&!l?(VideoPlayer.start(),5>p?(f=setTimeout(r,1E3*(5-p)),p++):(p=0,f&&
(clearTimeout(f),f=null),c(Player.state.ERROR))):f&&(p=0,clearTimeout(f),f=null)}function m(b){return!0}var a=this,s=Player.prototype.bounds,g=s,l=!1,d=!1,h=!1,e=null,q=null,p=0,f,n;a.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){d&&e&&VideoPlayer&&(l=!0,c(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){d&&e&&c(Player.state.EOF)},VideoPlayer.onPlaybackUnexpectedStop=function(){d&&e&&l&&(c(Player.state.STOP),g[3]!==a.bounds[3]&&(a.bounds=g))},VideoPlayer.onPlaybackError=
function(){d&&e&&c(Player.state.ERROR)});TVContext&&(TVContext.onContentSelectionSucceeded=function(){d||(syncProgramData(),fire.call(a,"onChannelChange"),g[3]!==a.bounds[3]&&(a.bounds=g))});getter(a,"id",function(){return Player.TV});getter(a,"type",function(){return Player.type.VIDEO});getter(a,"supports",function(){return m});getter(a,"waitIndicator",function(){return!1});getter(a,"channel",function(){var b=currentChannel||{};return new TVChannel(b.number,b.name)});setter(a,"channel",function(b){TVContext&&
TVContext.selectContentByID("service:number:"+b)});getter(a,"program",function(){var b=currentProgram||{};return new TVProgram(b.title,b.description,b.startTime,b.duration)});getter(a,"startTime",function(){return 0});setter(a,"startTime",function(b){});getter(a,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(b){return 0}});setter(a,"currentTime",function(b){if(VideoPlayer)try{VideoPlayer.seek(1E3*b)}catch(a){}});getter(a,"rate",function(){if(l&&VideoPlayer)try{return VideoPlayer.speed||
0}catch(b){return 1}else return 1});setter(a,"rate",function(b){});getter(a,"duration",function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(b){return 0}});getter(a,"buffered",function(){return 100});getter(a,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(b){return!1}});setter(a,"muted",function(b){if(AudioPlayer)try{AudioPlayer.mute(!0===b)}catch(a){}});getter(a,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(b){return 1}else return 1});
setter(a,"volume",function(b){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*b,10))}catch(a){}});getter(a,"src",function(){return d&&e});setter(a,"src",function(b){if(b&&VideoPlayer&&!e){l=!1;q=null;h=!1;f&&(clearTimeout(f),f=null);c(Player.state.BUFFERING);if(!d)try{VideoPlayer.grab(),d=!0}catch(a){return}else if(e&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(g){}try{VideoPlayer.setURI(b),e=b,r.delay(800)}catch(k){}}else if(e&&VideoPlayer){l=!1;q=e=
null;h=!1;n&&(clearInterval(n),n=null);f&&(clearTimeout(f),f=null);if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(m){}c(Player.state.STOP);(function(){if(d&&!e){d=!1;try{VideoPlayer.ungrab()}catch(b){}}}).delay(800)}});getter(a,"paused",function(){return h});setter(a,"paused",function(b){if(d&&VideoPlayer)if(!1===b&&!0===h)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),h=!1}catch(a){}else if(!0===b&&!1===
h)try{VideoPlayer.pause(),h=!0}catch(e){}h?n&&(clearInterval(n),n=null):n=setInterval(k,1E3);c(h?Player.state.PAUSE:Player.state.PLAY)});getter(a,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:s});setter(a,"bounds",function(b){var a=b&&b.length||0;1<a&&VideoPlayer&&(4===a&&VideoPlayer.setSize(b[2],b[3]),VideoPlayer.move(b[0],b[1]));g=b})};NDSPlayer.prototype=new Player;NDSPlayer.prototype.constructor=NDSPlayer;plugins.players.push(new NDSPlayer);
var NDSCOUNTRIES={eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",che:"ch",fre:"fr",fra:"fr",ger:"de",deu:"de",irl:"ie"},NDSLANGUAGES={ang:"en",eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",fre:"fr",fra:"fr",frm:"fr",fro:"fr",ger:"de",deu:"de",gmh:"de",goh:"de",ita:"it",irl:"en",gla:"en",gle:"en"};plugins.storage=new CookieStorage;
var NDSProfile=function(c){function k(a){try{return UserData&&UserData.get(a)}catch(c){}return null}function r(a){return!0}var m=!1,a=0;getter(this,"id",function(){return md5(this.household+"|"+(c||""))});getter(this,"name",function(){return c||k(UserData.KEY_PROFILE_USER_NAME)||""});getter(this,"ageRating",function(){return k(UserData.KEY_PROFILE_PARENTAL_AGE)||0});getter(this,"household",function(){return md5(this.operator+(UserData&&k(UserData.KEY_PROFILE_USER_ID)||0))});getter(this,"operator",
function(){return"horizon"});getter(this,"packages",function(){return[]});getter(this,"country",function(){return GEO&&GEO.geo&&GEO.geo.countryName});getter(this,"countryCode",function(){var a=(UserData&&k(UserData.KEY_PROFILE_COUNTRY)||GEO&&GEO.geo&&GEO.geo.country||"eu").toLowerCase();return NDSCOUNTRIES[a]||a});getter(this,"language",function(){return LANGUAGES[this.languageCode]});getter(this,"languageCode",function(){var a=(UserData&&k(UserData.KEY_PROFILE_UI_LANG)||MAE.language||html.lang||
"en").toLowerCase();return NDSLANGUAGES[a]||a});getter(this,"city",function(){return GEO&&GEO.geo&&GEO.geo.city});getter(this,"latlon",function(){return GEO&&GEO.geo&&GEO.geo.ll||[]});getter(this,"ip",function(){return GEO&&GEO.ip||"127.0.0.1"});getter(this,"mac",function(){return"00:00:00:00:00:00"});getter(this,"locale",function(){return this.languageCode+"-"+this.countryCode.toUpperCase()});getter(this,"locked",function(){return m});getter(this,"hasPIN",function(){return r});var s=function(){m=
!1;a=0},g=function(a,c){try{return User&&User.challengePINCode(a,c)}catch(d){}return null},l=function(c,e){if(m)return!1;var d;switch(e){case "adult":d=g(User.ADULT_PIN,c);break;case "youth":d=g(User.YOUTH_PIN,c);break;default:d=g(User.MASTER_PIN,c)}switch(d){case User.PIN_SUCCESS:return m=!1,!0;case User.PIN_RETRY:return a++,3===a&&(m=!0,s.delay(9E5)),!1;case User.PIN_NOT_SET:case User.PIN_LOCKED:return!1;default:return!1}};getter(this,"validatePIN",function(){return l});var d=new GenericStorage("pp",
!0);getter(this,"passport",function(){return d})};NDSProfile.prototype=new Profile;NDSProfile.prototype.constructor=NDSProfile;plugins.profile=NDSProfile;var resetNDSPlayer=function(){var c=plugins.players[0];c&&(c.src="")},getUIWindow=function(){return apps[ui]&&apps[ui].document.body};
Application&&(Application.onShow=function(){syncProgramData();(function(){var c=getUIWindow();c&&(c.visible=!0,ApplicationManager.fire(active,"onSelect",{id:apps[active].currentViewId}))}).delay(800)},Application.onHide=function(){var c=getUIWindow();c&&(c.visible=!1);resetNDSPlayer();(function(){active&&active!==ui&&ApplicationManager.close(active)}).delay(1E3)},syncProgramData());window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){Application&&Application.pause();var c=getUIWindow();c&&(c.visible=!1)});