var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
UserData=TVContext&&TVContext.getUserData(),Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance(),currentChannel,currentProgram,timerProgramData;KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var syncProgramData=function(){var c=MAE.blocked&&plugins.players[0];timerProgramData&&(clearTimeout(timerProgramData),timerProgramData=void 0);currentChannel=TVContext&&TVContext.getCurrentChannel();MAE.blocked&&-1!==MAE.blocked.indexOf(currentChannel.number)?c&&(c.hide(),c.muted=!0,currentProgram=void 0):(c&&c.muted&&(c.show(),c.muted=!1),currentProgram=currentChannel&&currentChannel.getCurrentProgram());timerProgramData=setTimeout(syncProgramData,1E3*currentProgram.duration)},NDSPlayer=function(){function c(b){s!==
b&&(fire.call(a,"onStateChange",{state:b}),s=b)}function h(){fire.call(a,"onTimeChange")}function t(){d&&!k?(VideoPlayer.start(),q<u?(f=setTimeout(t,1E3*(u-q)),q++):(q=0,f&&(clearTimeout(f),f=null),c(Player.state.ERROR))):f&&(q=0,clearTimeout(f),f=null)}function l(b){return!0}function r(b,a,c,e){c=c||"alert";e=e||active;try{var d=NDS&&NDS.Notification_getInstance();if(d){b&&d.setIconURL&&d.setIconURL(b);switch(typeOf(a)){case "array":d.setMessageStrings(a);break;case "string":d.setMessageStrings(a.split(", "));
break;default:return}switch(c){case "alert":d.setType(d.NOTIFICATION_TYPE_ALERT);break;case "c2a":if(MAE.pait&&MAE.pait[e]){d.setType(d.NOTIFICATION_TYPE_CALL2ACTION);d.setCall2ActionTarget("app:"+MAE.pait[e]);break}return;default:return}d.post()}}catch(g){}}var a=this,p=Player.prototype.bounds,m=p,k=!1,e=!1,g=!1,d=null,s=null,u=10,q=0,f,n;a.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){e&&d&&VideoPlayer&&(k=!0,c(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){e&&
d&&c(Player.state.EOF)},VideoPlayer.onPlaybackUnexpectedStop=function(){e&&d&&k&&(c(Player.state.STOP),m[3]!==a.bounds[3]&&(a.bounds=m))},VideoPlayer.onPlaybackError=function(){e&&d&&c(Player.state.ERROR)});TVContext&&(TVContext.onContentSelectionSucceeded=function(){e||(syncProgramData(),fire.call(a,"onChannelChange"),m[3]!==a.bounds[3]&&(a.bounds=m))});getter(a,"id",function(){return Player.TV});getter(a,"type",function(){return Player.type.VIDEO});getter(a,"supports",function(){return l});getter(a,
"waitIndicator",function(){return!1});getter(a,"channel",function(){var b=currentChannel||{};return new TVChannel(b.number,b.name)});setter(a,"channel",function(b){TVContext&&TVContext.selectContentByID("service:number:"+b)});getter(a,"program",function(){var b=currentProgram||{};return new TVProgram(b.title,b.description,b.startTime,b.duration)});getter(a,"startTime",function(){return 0});setter(a,"startTime",function(b){});getter(a,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/
1E3||0}catch(b){return 0}});setter(a,"currentTime",function(b){if(VideoPlayer)try{VideoPlayer.seek(1E3*b)}catch(a){}});getter(a,"rate",function(){if(k&&VideoPlayer)try{return VideoPlayer.speed||0}catch(b){return 1}else return 1});setter(a,"rate",function(b){});getter(a,"duration",function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(b){return 0}});getter(a,"buffered",function(){return 100});getter(a,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(b){return!1}});
setter(a,"muted",function(b){if(AudioPlayer)try{AudioPlayer.mute(!0===b)}catch(a){}});getter(a,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(b){return 1}else return 1});setter(a,"volume",function(b){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*b,10))}catch(a){}});getter(a,"src",function(){return e&&d});setter(a,"src",function(b){if(b&&VideoPlayer&&!d){k=!1;s=null;g=!1;f&&(clearTimeout(f),f=null);c(Player.state.BUFFERING);if(!e)try{VideoPlayer.grab(),e=!0}catch(a){return}else if(d&&
VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(h){}try{VideoPlayer.setURI(b),d=b,t.delay(800)}catch(l){}}else if(d&&VideoPlayer){k=!1;s=d=null;g=!1;n&&(clearInterval(n),n=null);f&&(clearTimeout(f),f=null);if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(m){}c(Player.state.STOP);(function(){if(e&&!d){e=!1;try{VideoPlayer.ungrab()}catch(b){}}}).delay(800)}});getter(a,"paused",function(){return g});setter(a,"paused",function(b){if(e&&
VideoPlayer)if(!1===b&&!0===g)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),g=!1}catch(a){}else if(!0===b&&!1===g)try{VideoPlayer.pause(),g=!0}catch(d){}g?n&&(clearInterval(n),n=null):n=setInterval(h,1E3);c(g?Player.state.PAUSE:Player.state.PLAY)});getter(a,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:p});setter(a,"bounds",function(b){var a=b&&b.length||0;1<a&&VideoPlayer&&(4===a&&VideoPlayer.setSize(b[2],
b[3]),VideoPlayer.move(b[0],b[1]));m=b});getter(a,"notify",function(){return r})};NDSPlayer.prototype=new Player;NDSPlayer.prototype.constructor=NDSPlayer;plugins.players.push(new NDSPlayer);var NDSCOUNTRIES={eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",che:"ch",fre:"fr",fra:"fr",ger:"de",deu:"de",irl:"ie"},NDSLANGUAGES={ang:"en",eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",fre:"fr",fra:"fr",frm:"fr",fro:"fr",ger:"de",deu:"de",gmh:"de",goh:"de",ita:"it",irl:"en",gla:"en",gle:"en"};
plugins.storage=new CookieStorage;
var NDSProfile=function(c){function h(a){try{return UserData&&UserData.get(a)}catch(c){}return null}function t(a){return!0}var l=!1,r=0;getter(this,"id",function(){return md5(this.household+"|"+(c||""))});getter(this,"name",function(){return c||h(UserData.KEY_PROFILE_USER_NAME)||""});getter(this,"ageRating",function(){return h(UserData.KEY_PROFILE_PARENTAL_AGE)||0});getter(this,"household",function(){return md5(this.operator+(UserData&&h(UserData.KEY_PROFILE_USER_ID)||0))});getter(this,"operator",
function(){return"horizon"});getter(this,"packages",function(){return[]});getter(this,"country",function(){return GEO&&GEO.geo&&GEO.geo.countryName});getter(this,"countryCode",function(){var a=(UserData&&h(UserData.KEY_PROFILE_COUNTRY)||GEO&&GEO.geo&&GEO.geo.country||"eu").toLowerCase();return NDSCOUNTRIES[a]||a});getter(this,"language",function(){return LANGUAGES[this.languageCode]});getter(this,"languageCode",function(){var a=(UserData&&h(UserData.KEY_PROFILE_UI_LANG)||MAE.language||html.lang||
"en").toLowerCase();return NDSLANGUAGES[a]||a});getter(this,"city",function(){return GEO&&GEO.geo&&GEO.geo.city});getter(this,"latlon",function(){return GEO&&GEO.geo&&GEO.geo.ll||[]});getter(this,"ip",function(){return GEO&&GEO.ip||"127.0.0.1"});getter(this,"mac",function(){return"00:00:00:00:00:00"});getter(this,"locale",function(){return this.languageCode+"-"+this.countryCode.toUpperCase()});getter(this,"locked",function(){return l});getter(this,"hasPIN",function(){return t});var a=function(){l=
!1;r=0},p=function(a,c){try{return User&&User.challengePINCode(a,c)}catch(d){}return null},m=function(c,g){if(l)return!1;var d;switch(g){case "adult":d=p(User.ADULT_PIN,c);break;case "youth":d=p(User.YOUTH_PIN,c);break;default:d=p(User.MASTER_PIN,c)}switch(d){case User.PIN_SUCCESS:return l=!1,!0;case User.PIN_RETRY:return r++,3===r&&(l=!0,a.delay(9E5)),!1;case User.PIN_NOT_SET:case User.PIN_LOCKED:return!1;default:return!1}};getter(this,"validatePIN",function(){return m});var k=new GenericStorage("pp",
!0);getter(this,"passport",function(){return k})};NDSProfile.prototype=new Profile;NDSProfile.prototype.constructor=NDSProfile;plugins.profile=NDSProfile;var resetNDSPlayer=function(){var c=plugins.players[0];c&&(c.src="")},getUIWindow=function(){return apps[ui]&&apps[ui].document.body};
Application&&(Application.onShow=function(){syncProgramData();(function(){var c=getUIWindow();c&&(c.visible=!0,ApplicationManager.fire(active,"onSelect",{id:apps[active].currentViewId}))}).delay(800)},Application.onHide=function(){var c=getUIWindow();c&&(c.visible=!1);resetNDSPlayer();(function(){active&&active!==ui&&ApplicationManager.close(active)}).delay(1E3)},syncProgramData());window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){Application&&Application.pause();var c=getUIWindow();c&&(c.visible=!1)});MAE.pait&&function(){var c=ApplicationManager.getAboutIcon("com.metrological.widgets.tv.Youtube");plugins.players[0].notify(c,["YouTube","Press OK"],"c2a","com.metrological.widgets.tv.Youtube")}.delay(6E4);