var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
UserData=TVContext&&TVContext.getUserData(),Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance();KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var NDSPlayer=function(){function c(b){q!==b&&(fire.call(a,"onStateChange",{state:b}),q=b)}function p(){f&&!h?(screen.log("START"),VideoPlayer.start(),5>n?(g=setTimeout(p,1E3*(5-n)),n++):(n=0,g&&(clearTimeout(g),g=null),c(Player.state.ERROR))):g&&(screen.log("STARTED"),n=0,clearTimeout(g),g=null)}function m(b){return!0}var a=this,l=Player.prototype.bounds,k=l,h=!1,d=!1,e=!1,f=null,q=null,n=0,g;a.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){d&&f&&VideoPlayer&&(h=!0,screen.log("INFOLOADED"),
c(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){d&&f&&(screen.log("EOF"),c(Player.state.EOF))},VideoPlayer.onPlaybackUnexpectedStop=function(){d&&f&&h&&(screen.log("STOPPED"),c(Player.state.STOP),screen.log("BOUNDS:"+JSON.stringify(a.bounds)+", "+JSON.stringify(k)),k[3]!==a.bounds[3]&&(a.bounds=k))},VideoPlayer.onPlaybackError=function(){d&&f&&(screen.log("ERROR"),c(Player.state.ERROR))});TVContext&&(TVContext.onContentSelectionSucceeded=function(){d||(screen.log("CHANNEL CHANGE"),
fire.call(a,"onChannelChange"),screen.log("BOUNDS:"+JSON.stringify(a.bounds)+", "+JSON.stringify(k)),k[3]!==a.bounds[3]&&(a.bounds=k))});getter(a,"id",function(){return Player.TV});getter(a,"type",function(){return Player.type.VIDEO});getter(a,"supports",function(){return m});getter(a,"waitIndicator",function(){return!1});getter(a,"channel",function(){var b=TVContext&&TVContext.getCurrentChannel()||{};return new TVChannel(b.number,b.name)});setter(a,"channel",function(b){TVContext&&TVContext.selectContentByID("service:number:"+
b)});getter(a,"program",function(){var b=TVContext&&TVContext.getCurrentChannel(),b=b&&b.getCurrentProgram()||{};return new TVProgram(b.title,b.description,b.startTime,b.duration)});getter(a,"startTime",function(){return 0});setter(a,"startTime",function(b){});getter(a,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(b){return 0}});setter(a,"currentTime",function(b){if(VideoPlayer)try{VideoPlayer.seek(1E3*b)}catch(a){}});getter(a,"rate",function(){if(h&&VideoPlayer)try{return VideoPlayer.speed||
0}catch(b){return 1}else return 1});setter(a,"rate",function(b){});getter(a,"duration",function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(b){return 0}});getter(a,"buffered",function(){return 100});getter(a,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(b){return!1}});setter(a,"muted",function(b){if(AudioPlayer)try{AudioPlayer.mute(!0===b)}catch(a){}});getter(a,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(b){return 1}else return 1});
setter(a,"volume",function(b){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*b,10))}catch(a){}});getter(a,"src",function(){return d&&f});setter(a,"src",function(b){if(b&&VideoPlayer&&!f){h=!1;q=null;e=!1;g&&(clearTimeout(g),g=null);screen.log("BUFFERING");c(Player.state.BUFFERING);if(!d)try{VideoPlayer.grab(),d=!0}catch(a){return}else if(f&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(n){}try{screen.log("LOAD"),VideoPlayer.setURI(b),f=b,p.delay(800)}catch(k){screen.log("LOAD ERROR")}}else if(f&&
VideoPlayer){h=!1;q=f=null;e=!1;g&&(clearTimeout(g),g=null);if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(l){}screen.log("STOP");c(Player.state.STOP);(function(){if(d&&!f){d=!1;try{VideoPlayer.ungrab()}catch(b){}}}).delay(800)}});getter(a,"paused",function(){return e});setter(a,"paused",function(b){if(d&&VideoPlayer)if(!1===b&&!0===e)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),e=!1}catch(a){}else if(!0===
b&&!1===e)try{VideoPlayer.pause(),e=!0}catch(f){}screen.log(e?"PAUSED":"RESUME");c(e?Player.state.PAUSE:Player.state.PLAY)});getter(a,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:l});setter(a,"bounds",function(b){var a=b&&b.length||0;1<a&&VideoPlayer&&(4===a&&VideoPlayer.setSize(b[2],b[3]),VideoPlayer.move(b[0],b[1]));k=b})};NDSPlayer.prototype=new Player;NDSPlayer.prototype.constructor=NDSPlayer;plugins.players.push(new NDSPlayer);
var NDSCOUNTRIES={eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",che:"ch",fre:"fr",fra:"fr",ger:"de",deu:"de",irl:"ie"},NDSLANGUAGES={ang:"en",eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",fre:"fr",fra:"fr",frm:"fr",fro:"fr",ger:"de",deu:"de",gmh:"de",goh:"de",ita:"it",irl:"en",gla:"en",gle:"en"};plugins.storage=new CookieStorage;
var NDSProfile=function(c){function p(a){switch(a){case "adult":a=User.ADULT_PIN;break;case "youth":a=User.ADULT_PIN;break;default:a=User.MASTER_PIN}try{return UserData&&UserData.isPINSet(a)||!1}catch(c){return!1}}var m=!1,a=0,l=function(a){try{return UserData&&UserData.get(a)}catch(c){}return null};getter(this,"id",function(){return md5(this.household+"|"+(c||""))});getter(this,"name",function(){return c||l(UserData.KEY_PROFILE_USER_NAME)||""});getter(this,"ageRating",function(){return l(UserData.KEY_PROFILE_PARENTAL_AGE)||
0});getter(this,"household",function(){return md5(this.operator+(UserData&&l(UserData.KEY_PROFILE_USER_ID)||0))});getter(this,"operator",function(){return"horizon"});getter(this,"packages",function(){return[]});getter(this,"country",function(){return GEO&&GEO.geo&&GEO.geo.countryName});getter(this,"countryCode",function(){var a=(UserData&&l(UserData.KEY_PROFILE_COUNTRY)||GEO&&GEO.geo&&GEO.geo.country||"eu").toLowerCase();return NDSCOUNTRIES[a]||a});getter(this,"language",function(){return LANGUAGES[this.languageCode]});
getter(this,"languageCode",function(){var a=(UserData&&l(UserData.KEY_PROFILE_UI_LANG)||MAE.language||html.lang||"en").toLowerCase();return NDSLANGUAGES[a]||a});getter(this,"city",function(){return GEO&&GEO.geo&&GEO.geo.city});getter(this,"latlon",function(){return GEO&&GEO.geo&&GEO.geo.ll||[]});getter(this,"ip",function(){return GEO&&GEO.ip||"127.0.0.1"});getter(this,"mac",function(){return"00:00:00:00:00:00"});getter(this,"locale",function(){return this.languageCode+"-"+this.countryCode.toUpperCase()});
getter(this,"locked",function(){return m});getter(this,"hasPIN",function(){return p});var k=function(){m=!1;a=0},h=function(a,c){try{return User&&User.challengePINCode(a,c)}catch(d){}return null},d=function(c,d){if(!p(d))return!0;if(m)return!1;var e;switch(d){case "adult":e=h(User.ADULT_PIN,c);break;case "youth":e=h(User.YOUTH_PIN,c);break;default:e=h(User.MASTER_PIN,c)}switch(e){case User.PIN_SUCCESS:return m=!1,!0;case User.PIN_RETRY:return a++,3===a&&(m=!0,k.delay(9E5)),!1;case User.PIN_NOT_SET:case User.PIN_LOCKED:return!1;
default:return!1}};getter(this,"validatePIN",function(){return d});var e=new GenericStorage("pp",!0);getter(this,"passport",function(){return e})};NDSProfile.prototype=new Profile;NDSProfile.prototype.constructor=NDSProfile;plugins.profile=NDSProfile;var resetNDSPlayer=function(){var c=plugins.players[0];c&&(c.src="")},getUIWindow=function(){return apps[ui]&&apps[ui].document.body};
Application&&(Application.onShow=function(){(function(){var c=getUIWindow();c&&(screen.log("ONSHOW"),c.visible=!0,ApplicationManager.fire(active,"onSelect",{id:apps[active].currentViewId}))}).delay(800)},Application.onHide=function(){var c=getUIWindow();c&&(screen.log("ONHIDE"),c.visible=!1);resetNDSPlayer();active&&active!==ui&&ApplicationManager.close(active)});window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){Application&&Application.pause();var c=getUIWindow();c&&(screen.log("HIDE"),c.visible=!1)});