var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance();KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var NDSPlayer=function(){function e(a){h!==a&&(fire.call(b,"onStateChange",{state:a}),h=a)}function k(a){return!0}var b=this,l=Player.prototype.bounds,g=!1,d=!1,f=!1,c=null,h=null;b.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){d&&c&&VideoPlayer&&(g=!0,e(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){d&&c&&e(Player.state.EOF)},VideoPlayer.onPlaybackUnexpectedStop=function(){d&&c&&g&&e(Player.state.STOP)},VideoPlayer.onPlaybackError=function(){d&&c&&e(Player.state.ERROR)});
TVContext&&(TVContext.onContentSelectionSucceeded=function(){d||fire.call(b,"onChannelChange")});getter(b,"id",function(){return Player.TV});getter(b,"type",function(){return Player.type.VIDEO});getter(b,"supports",function(){return k});getter(b,"waitIndicator",function(){return!1});getter(b,"channel",function(){var a=TVContext&&TVContext.getCurrentChannel()||{};return new TVChannel(a.number,a.name)});setter(b,"channel",function(a){TVContext&&TVContext.selectContentByID("service:number:"+a)});getter(b,
"program",function(){var a=TVContext&&TVContext.getCurrentChannel()||{},a=a&&a.getCurrentProgram()||{};return new TVProgram(a.title,a.description,a.startTime,a.duration)});getter(b,"startTime",function(){return 0});setter(b,"startTime",function(a){});getter(b,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(a){return 0}});setter(b,"currentTime",function(a){if(VideoPlayer)try{VideoPlayer.seek(1E3*a)}catch(b){}});getter(b,"rate",function(){if(g&&VideoPlayer)try{return VideoPlayer.speed||
0}catch(a){return 1}else return 1});setter(b,"rate",function(a){});getter(b,"duration",function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(a){return 0}});getter(b,"buffered",function(){return 100});getter(b,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(a){return!1}});setter(b,"muted",function(a){if(AudioPlayer)try{AudioPlayer.mute(!0===a)}catch(b){}});getter(b,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(a){return 1}else return 1});
setter(b,"volume",function(a){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*a,10))}catch(b){}});getter(b,"src",function(){return d&&c});setter(b,"src",function(a){if(a&&VideoPlayer&&!c){g=!1;h=null;f=!1;e(Player.state.BUFFERING);if(!d)try{VideoPlayer.grab(),d=!0}catch(b){return}else if(c&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(k){}try{VideoPlayer.setURI(a),c=a,VideoPlayer.start.delay(800,VideoPlayer)}catch(l){}}else if(c&&VideoPlayer){g=!1;h=c=
null;f=!1;if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(m){}e(Player.state.STOP);(function(){if(d&&!c){d=!1;try{VideoPlayer.ungrab()}catch(a){}}}).delay(800)}});getter(b,"paused",function(){return f});setter(b,"paused",function(a){if(d&&VideoPlayer)if(!1===a&&!0===f)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),f=!1}catch(b){}else if(!0===a&&!1===f)try{VideoPlayer.pause(),f=!0}catch(c){}e(f?Player.state.PAUSE:
Player.state.PLAY)});getter(b,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:l});setter(b,"bounds",function(a){var b=a&&a.length||0;1<b&&VideoPlayer&&(4===b&&VideoPlayer.setSize(a[2],a[3]),VideoPlayer.move(a[0],a[1]))})};plugins.players.push(new NDSPlayer);var resetNDSPlayer=function(){var e=plugins.players[0];e&&(e.src="")};Application&&(Application.onHide=function(){resetNDSPlayer()});window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){resetNDSPlayer();Application&&Application.pause()});