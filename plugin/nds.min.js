var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
UserData=TVContext&&TVContext.getUserData(),Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance(),currentChannel,currentProgram,timerProgramData;KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var syncProgramData=function(){var c=MAE.blocked&&plugins.players[0];timerProgramData&&(clearTimeout(timerProgramData),timerProgramData=void 0);currentChannel=TVContext&&TVContext.getCurrentChannel();MAE.blocked&&-1!==MAE.blocked.indexOf(currentChannel.number)?c&&(c.hide(),c.muted=!0,currentProgram=void 0):(c&&c.muted&&(c.show(),c.muted=!1),currentProgram=currentChannel&&currentChannel.getCurrentProgram());timerProgramData=setTimeout(syncProgramData,1E3*currentProgram.duration)},NDSPlayer=function(){function c(b){switch(b){case 30:return VideoPlayer.PLAYER_SPD_FWD30X;
case 12:return VideoPlayer.PLAYER_SPD_FWD12X;case 6:return VideoPlayer.PLAYER_SPD_FWD6X;case 2:return VideoPlayer.PLAYER_SPD_FWD2X;case -30:return VideoPlayer.PLAYER_SPD_REW30X;case -12:return VideoPlayer.PLAYER_SPD_REW12X;case -6:return VideoPlayer.PLAYER_SPD_REW6X;case -2:return VideoPlayer.PLAYER_SPD_REW2X;default:return VideoPlayer.PLAYER_SPD_PLAY}}function d(b){r!==b&&(fire.call(a,"onStateChange",{state:b}),r=b)}function t(){fire.call(a,"onTimeChange")}function l(){g&&!h?(VideoPlayer.start(),
p<v?(f=setTimeout(l,1E3*(v-p)),p++):(p=0,f&&(clearTimeout(f),f=null),d(Player.state.ERROR))):f&&(p=0,clearTimeout(f),f=null)}function q(b){return!0}function u(b,a,c,h){c=c||"alert";h=h||active;try{var d=NDS&&NDS.Notification_getInstance();if(d){b&&d.setIconURL&&d.setIconURL(b);switch(typeOf(a)){case "array":d.setMessageStrings(a);break;case "string":d.setMessageStrings(a.split(", "));break;default:return}switch(c){case "alert":d.setType(d.NOTIFICATION_TYPE_ALERT);break;case "c2a":if(MAE.pait&&MAE.pait[h]){d.setType(d.NOTIFICATION_TYPE_CALL2ACTION);
d.setCall2ActionTarget("app:"+MAE.pait[h]);break}return;default:return}d.post()}}catch(k){}}var a=this,s=Player.prototype.bounds,m=s,h=!1,k=!1,e=!1,g=null,r=null,v=10,p=0,f,n;a.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){k&&g&&VideoPlayer&&(h=!0,d(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){k&&g&&d(Player.state.EOF)},VideoPlayer.onPlaybackUnexpectedStop=function(){k&&g&&h&&(d(Player.state.STOP),m[3]!==a.bounds[3]&&(a.bounds=m))},VideoPlayer.onPlaybackError=
function(){k&&g&&d(Player.state.ERROR)});TVContext&&(TVContext.onContentSelectionSucceeded=function(){k||(syncProgramData(),fire.call(a,"onChannelChange"),m[3]!==a.bounds[3]&&(a.bounds=m))});getter(a,"id",function(){return Player.TV});getter(a,"type",function(){return Player.type.VIDEO});getter(a,"supports",function(){return q});getter(a,"waitIndicator",function(){return!1});getter(a,"channel",function(){var b=currentChannel||{};return new TVChannel(b.number,b.name)});setter(a,"channel",function(b){TVContext&&
TVContext.selectContentByID("service:number:"+b)});getter(a,"program",function(){var b=currentProgram||{};return new TVProgram(b.title,b.description,b.startTime,b.duration)});getter(a,"startTime",function(){return 0});setter(a,"startTime",function(b){});getter(a,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(b){return 0}});setter(a,"currentTime",function(b){if(VideoPlayer)try{VideoPlayer.seek(1E3*b)}catch(a){}});getter(a,"rates",function(){return[1,2,6,12,30]});
getter(a,"rate",function(){if(h&&VideoPlayer)try{return c(VideoPlayer.speed)||1}catch(b){return 1}else return 1});setter(a,"rate",function(b){if(VideoPlayer&&h&&this.rate!==b){try{VideoPlayer.setSpeed(getRateByInt(b))}catch(a){return}0>b?d(Player.state.REWIND):1==b?d(Player.state.PLAY):0<b?d(Player.state.FORWARD):d(Player.state.PAUSE)}});getter(a,"duration",function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(b){return 0}});getter(a,"buffered",function(){return 100});getter(a,
"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(b){return!1}});setter(a,"muted",function(b){if(AudioPlayer)try{AudioPlayer.mute(!0===b)}catch(a){}});getter(a,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(b){return 1}else return 1});setter(a,"volume",function(b){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*b,10))}catch(a){}});getter(a,"src",function(){return k&&g});setter(a,"src",function(b){if(b&&VideoPlayer&&!g)if(h=!1,r=null,e=!1,
f&&(clearTimeout(f),f=null),d(Player.state.BUFFERING),512<b.length)d(Player.state.ERROR);else{if(!k)try{VideoPlayer.grab(),k=!0}catch(a){return}else if(g&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(c){}try{VideoPlayer.setURI(b),g=b,l.delay(800)}catch(m){}}else if(g&&VideoPlayer){h=!1;r=g=null;e=!1;n&&(clearInterval(n),n=null);f&&(clearTimeout(f),f=null);if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(p){}d(Player.state.STOP);
(function(){if(k&&!g){k=!1;try{VideoPlayer.ungrab()}catch(b){}}}).delay(800)}});getter(a,"paused",function(){return e});setter(a,"paused",function(b){if(k&&VideoPlayer)if(!1===b&&!0===e)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),e=!1}catch(a){}else if(!0===b&&!1===e)try{VideoPlayer.pause(),e=!0}catch(c){}e?n&&(clearInterval(n),n=null):n=setInterval(t,1E3);d(e?Player.state.PAUSE:Player.state.PLAY)});getter(a,"bounds",function(){return VideoPlayer?
[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:s});setter(a,"bounds",function(b){var a=b&&b.length||0;1<a&&VideoPlayer&&(4===a&&VideoPlayer.setSize(b[2],b[3]),VideoPlayer.move(b[0],b[1]));m=b});getter(a,"notify",function(){return u})};NDSPlayer.prototype=new Player;NDSPlayer.prototype.constructor=NDSPlayer;plugins.players.push(new NDSPlayer);
var NDSCOUNTRIES={eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",che:"ch",fre:"fr",fra:"fr",ger:"de",deu:"de",irl:"ie"},NDSLANGUAGES={ang:"en",eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",fre:"fr",fra:"fr",frm:"fr",fro:"fr",ger:"de",deu:"de",gmh:"de",goh:"de",ita:"it",irl:"en",gla:"en",gle:"en"};plugins.storage=new CookieStorage;
var NDSProfile=function(c){function d(a){try{return UserData&&UserData.get(a)}catch(c){}return null}function t(a){return!0}var l=!1,q=0;getter(this,"id",function(){return md5(this.household+"|"+(c||""))});getter(this,"name",function(){return c||d(UserData.KEY_PROFILE_USER_NAME)||""});getter(this,"ageRating",function(){return d(UserData.KEY_PROFILE_PARENTAL_AGE)||0});getter(this,"household",function(){return md5(this.operator+(UserData&&d(UserData.KEY_PROFILE_USER_ID)||0))});getter(this,"operator",
function(){return"horizon"});getter(this,"packages",function(){return[]});getter(this,"country",function(){return GEO&&GEO.geo&&GEO.geo.countryName});getter(this,"countryCode",function(){var a=(UserData&&d(UserData.KEY_PROFILE_COUNTRY)||GEO&&GEO.geo&&GEO.geo.country||"eu").toLowerCase();return NDSCOUNTRIES[a]||a});getter(this,"language",function(){return LANGUAGES[this.languageCode]});getter(this,"languageCode",function(){var a=(UserData&&d(UserData.KEY_PROFILE_UI_LANG)||MAE.language||html.lang||
"en").toLowerCase();return NDSLANGUAGES[a]||a});getter(this,"city",function(){return GEO&&GEO.geo&&GEO.geo.city});getter(this,"latlon",function(){return GEO&&GEO.geo&&GEO.geo.ll||[]});getter(this,"ip",function(){return GEO&&GEO.ip||"127.0.0.1"});getter(this,"mac",function(){return"00:00:00:00:00:00"});getter(this,"locale",function(){return this.languageCode+"-"+this.countryCode.toUpperCase()});getter(this,"locked",function(){return l});getter(this,"hasPIN",function(){return t});var u=function(){l=
!1;q=0},a=function(a,c){try{return User&&User.challengePINCode(a,c)}catch(d){}return null},s=function(c,d){if(l)return!1;var e;switch(d){case "adult":e=a(User.ADULT_PIN,c);break;case "youth":e=a(User.YOUTH_PIN,c);break;default:e=a(User.MASTER_PIN,c)}switch(e){case User.PIN_SUCCESS:return l=!1,!0;case User.PIN_RETRY:return q++,3===q&&(l=!0,u.delay(9E5)),!1;case User.PIN_NOT_SET:case User.PIN_LOCKED:return!1;default:return!1}};getter(this,"validatePIN",function(){return s});var m=new GenericStorage("pp",
!0);getter(this,"passport",function(){return m})};NDSProfile.prototype=new Profile;NDSProfile.prototype.constructor=NDSProfile;plugins.profile=NDSProfile;var resetNDSPlayer=function(){var c=plugins.players[0];c&&(c.src="")},getUIWindow=function(){return apps[ui]&&apps[ui].document.body};
Application&&(Application.onShow=function(){syncProgramData();(function(){var c=getUIWindow();c&&(c.visible=!0,ApplicationManager.fire(active,"onSelect",{id:apps[active].currentViewId}))}).delay(800)},Application.onHide=function(){var c=getUIWindow();c&&(c.visible=!1);resetNDSPlayer();(function(){active&&active!==ui&&ApplicationManager.close(active)}).delay(1E3)},syncProgramData());window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){Application&&Application.pause();var c=getUIWindow();c&&(c.visible=!1)});MAE.pait&&function(){var c=ApplicationManager.getAboutIcon("com.metrological.widgets.tv.Youtube");plugins.players[0].notify(c,["YouTube","Press OK"],"c2a","com.metrological.widgets.tv.Youtube")}.delay(6E4);