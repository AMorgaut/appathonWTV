var NDS=createPluginObject("my_user_api","my_user_api","application/x-jsuserapi-plugin"),Application=NDS.Application_getInstance&&NDS.Application_getInstance(),VideoPlayer=NDS.Player_getInstance&&NDS.Player_getInstance(),AudioPlayer=NDS.AudioOutput_getInstance&&NDS.AudioOutput_getInstance(),TVContext=NDS.ApplicationTvContext_getInstance&&NDS.ApplicationTvContext_getInstance()||NDS.ApplicationTVContext_getInstance&&NDS.ApplicationTVContext_getInstance(),User=NDS.UserAuthentication_getInstance&&NDS.UserAuthentication_getInstance(),
UserData=TVContext&&TVContext.getUserData(),Planner=NDS.Planner_getInstance&&NDS.Planner_getInstance();KeyMap.defineKeys(KeyMap.NORMAL,{403:"red",404:"green",405:"yellow",406:"blue",413:"stop",415:"playpause",417:"forward",412:"rewind",462:"menu",461:"back"},!0);
var NDSPlayer=function(){function f(b){n!==b&&(fire.call(a,"onStateChange",{state:b}),n=b)}function p(){e&&!h?(screen.log("START"),VideoPlayer.start(),5>m?(c=setTimeout(p,1E3*(5-m)),m++):(m=0,c&&(clearTimeout(c),c=null),f(Player.state.ERROR))):c&&(screen.log("STARTED"),m=0,clearTimeout(c),c=null)}function k(b){return!0}var a=this,l=Player.prototype.bounds,h=!1,d=!1,g=!1,e=null,n=null,m=0,c;a.subscribers={};VideoPlayer&&(VideoPlayer.onPlaybackStarted=function(){d&&e&&VideoPlayer&&(h=!0,screen.log("INFOLOADED"),
f(Player.state.INFOLOADED))},VideoPlayer.onPlaybackEnd=function(){d&&e&&(screen.log("EOF"),f(Player.state.EOF))},VideoPlayer.onPlaybackUnexpectedStop=function(){d&&e&&h&&(screen.log("STOPPED"),f(Player.state.STOP),screen.log("BOUNDS:"+JSON.stringify(a.bounds)))},VideoPlayer.onPlaybackError=function(){d&&e&&(screen.log("ERROR"),f(Player.state.ERROR))});TVContext&&(TVContext.onContentSelectionSucceeded=function(){d||(screen.log("CHANNEL CHANGE"),fire.call(a,"onChannelChange"),screen.log("BOUNDS:"+JSON.stringify(a.bounds)))});
getter(a,"id",function(){return Player.TV});getter(a,"type",function(){return Player.type.VIDEO});getter(a,"supports",function(){return k});getter(a,"waitIndicator",function(){return!1});getter(a,"channel",function(){var b=TVContext&&TVContext.getCurrentChannel()||{};return new TVChannel(b.number,b.name)});setter(a,"channel",function(b){TVContext&&TVContext.selectContentByID("service:number:"+b)});getter(a,"program",function(){var b=TVContext&&TVContext.getCurrentChannel(),b=b&&b.getCurrentProgram()||
{};return new TVProgram(b.title,b.description,b.startTime,b.duration)});getter(a,"startTime",function(){return 0});setter(a,"startTime",function(b){});getter(a,"currentTime",function(){try{return VideoPlayer&&VideoPlayer.position/1E3||0}catch(b){return 0}});setter(a,"currentTime",function(b){if(VideoPlayer)try{VideoPlayer.seek(1E3*b)}catch(a){}});getter(a,"rate",function(){if(h&&VideoPlayer)try{return VideoPlayer.speed||0}catch(b){return 1}else return 1});setter(a,"rate",function(b){});getter(a,"duration",
function(){try{return VideoPlayer&&VideoPlayer.getPlaybackDuration()||0}catch(b){return 0}});getter(a,"buffered",function(){return 100});getter(a,"muted",function(){try{return AudioPlayer&&!0===AudioPlayer.muted||!1}catch(b){return!1}});setter(a,"muted",function(b){if(AudioPlayer)try{AudioPlayer.mute(!0===b)}catch(a){}});getter(a,"volume",function(){if(AudioPlayer)try{return AudioPlayer.level/100}catch(b){return 1}else return 1});setter(a,"volume",function(b){if(AudioPlayer)try{AudioPlayer.setVolume(parseInt(100*
b,10))}catch(a){}});getter(a,"src",function(){return d&&e});setter(a,"src",function(b){if(b&&VideoPlayer&&!e){h=!1;n=null;g=!1;c&&(clearTimeout(c),c=null);screen.log("BUFFERING");f(Player.state.BUFFERING);if(!d)try{VideoPlayer.grab(),d=!0}catch(a){return}else if(e&&VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(m){}try{screen.log("LOAD"),VideoPlayer.setURI(b),e=b,p.delay(800)}catch(k){screen.log("LOAD ERROR")}}else if(e&&VideoPlayer){h=!1;n=e=null;g=!1;c&&(clearTimeout(c),
c=null);if(VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED)try{VideoPlayer.stop()}catch(l){}screen.log("STOP");f(Player.state.STOP);(function(){if(d&&!e){d=!1;try{VideoPlayer.ungrab()}catch(b){}}}).delay(800)}});getter(a,"paused",function(){return g});setter(a,"paused",function(b){if(d&&VideoPlayer)if(!1===b&&!0===g)try{VideoPlayer.status!==VideoPlayer.PLAYER_STATUS_STOPPED?VideoPlayer.resume():VideoPlayer.start(),g=!1}catch(a){}else if(!0===b&&!1===g)try{VideoPlayer.pause(),g=!0}catch(n){}screen.log(g?
"PAUSED":"RESUME");f(g?Player.state.PAUSE:Player.state.PLAY)});getter(a,"bounds",function(){return VideoPlayer?[VideoPlayer.x,VideoPlayer.y,VideoPlayer.width,VideoPlayer.height]:l});setter(a,"bounds",function(b){var a=b&&b.length||0;1<a&&VideoPlayer&&(4===a&&VideoPlayer.setSize(b[2],b[3]),VideoPlayer.move(b[0],b[1]))})};NDSPlayer.prototype=new Player;NDSPlayer.prototype.constructor=NDSPlayer;plugins.players.push(new NDSPlayer);
var NDSCOUNTRIES={eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",che:"ch",fre:"fr",fra:"fr",ger:"de",deu:"de",irl:"ie"},NDSLANGUAGES={ang:"en",eng:"en",enm:"en",ned:"nl",nld:"nl",dut:"nl",fre:"fr",fra:"fr",frm:"fr",fro:"fr",ger:"de",deu:"de",gmh:"de",goh:"de",ita:"it",irl:"en",gla:"en",gle:"en"};plugins.storage=new CookieStorage;
var NDSProfile=function(){function f(a){switch(a){case "adult":a=User.ADULT_PIN;break;case "youth":a=User.ADULT_PIN;break;default:a=User.MASTER_PIN}try{return UserData&&UserData.isPINSet(a)||!1}catch(d){return!1}}var p=++Profile.__instances__,k=!1,a=0,l=function(a){try{return UserData&&UserData.get(a)}catch(d){}return null};getter(this,"id",function(){return md5(this.household+p)});getter(this,"name",function(){return l(UserData.KEY_PROFILE_USER_NAME)||""});getter(this,"ageRating",function(){return l(UserData.KEY_PROFILE_PARENTAL_AGE)||
0});getter(this,"household",function(){return md5(this.operator+(UserData&&l(UserData.KEY_PROFILE_USER_ID)||0))});getter(this,"operator",function(){return"horizon"});getter(this,"packages",function(){return[]});getter(this,"country",function(){return GEO&&GEO.geo&&GEO.geo.countryName});getter(this,"countryCode",function(){var a=(UserData&&l(UserData.KEY_PROFILE_COUNTRY)||GEO&&GEO.geo&&GEO.geo.country||"eu").toLowerCase();return NDSCOUNTRIES[a]||a});getter(this,"language",function(){return LANGUAGES[this.languageCode]});
getter(this,"languageCode",function(){var a=(UserData&&l(UserData.KEY_PROFILE_UI_LANG)||MAE.language||html.lang||"en").toLowerCase();return NDSLANGUAGES[a]||a});getter(this,"city",function(){return GEO&&GEO.geo&&GEO.geo.city});getter(this,"latlon",function(){return GEO&&GEO.geo&&GEO.geo.ll||[]});getter(this,"ip",function(){return GEO&&GEO.ip||"127.0.0.1"});getter(this,"mac",function(){return"00:00:00:00:00:00"});getter(this,"locale",function(){return this.languageCode+"-"+this.countryCode.toUpperCase()});
getter(this,"locked",function(){return k});getter(this,"hasPIN",function(){return f});var h=function(){k=!1;a=0},d=function(a,d){try{return User&&User.challengePINCode(a,d)}catch(c){}return null},g=function(e,g){if(!f(g))return!0;if(k)return!1;var c;switch(g){case "adult":c=d(User.ADULT_PIN,e);break;case "youth":c=d(User.YOUTH_PIN,e);break;default:c=d(User.MASTER_PIN,e)}switch(c){case User.PIN_SUCCESS:return k=!1,!0;case User.PIN_RETRY:return a++,3===a&&(k=!0,h.delay(9E5)),!1;case User.PIN_NOT_SET:case User.PIN_LOCKED:return!1;
default:return!1}};getter(this,"validatePIN",function(){return g});var e=new GenericStorage("pp",!0);getter(this,"passport",function(){return e})};NDSProfile.prototype=new Profile;NDSProfile.prototype.constructor=NDSProfile;plugins.profiles.push(new NDSProfile);var resetNDSPlayer=function(){var f=plugins.players[0];f&&(f.src="")};Application&&(Application.onHide=function(){resetNDSPlayer()});window.addEventListener("unload",function(){resetNDSPlayer()});
window.addEventListener("blur",function(){resetNDSPlayer();Application&&Application.pause()});